% Fonts
\usepackage{bera}
\usepackage[charter]{mathdesign}
\usepackage[lf,t]{FiraSans}
%\usepackage[scale=0.9]{sourcecodepro}

\usepackage{lastpage,fancyhdr,verbatimbox,bm}
\usepackage[bottom]{footmisc}

\usepackage[absolute,overlay]{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}

%% Line and page breaking
\sloppy
\raggedbottom
\allowdisplaybreaks
\setlength{\parskip}{1.2ex}
\setlength{\parindent}{0em}
\clubpenalty = 10000
\widowpenalty = 10000

%% CAPTIONS
\DeclareCaptionStyle{italic}[justification=centering]
 {labelfont={bf},textfont={it},labelsep=colon}
\captionsetup[figure]{style=italic,format=hang,singlelinecheck=true}
\captionsetup[table]{style=italic,format=hang,singlelinecheck=true}

%% Floats
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.8}

%% Headers and footers
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\lhead{}
\rhead{}
\cfoot{}
\rfoot{\sf\textsl{Page \thepage\ of \pageref{LastPage}}}

% Redefine plain style so first page matches the rest.
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
  \fancyfoot[R]{\sf\textsl{Page \thepage\ of \pageref{LastPage}}}
}

% TITLE PAGE
\usepackage{titling}
\title{}
\author{}
\preauthor{}
\postauthor{}
\predate{}
\postdate{}
\date{}
\posttitle{\newpage}
\pretitle{\fontsize{12}{14}\sf
  \begin{textblock}{13}(2,0.7)
    \includegraphics[height=1.2cm]{tudlogo_descriptor}
  \end{textblock}
 \begin{textblock}{17}(2,3)\sffamily
    \begin{center}\bfseries\Large
      $faculty$\\
      $department$\\[0.8cm]
    \end{center}\vspace*{0.4cm}
    \begin{tabular}{@{}p{4.5cm}p{10cm}}
      \bfseries UNIT CODES:  & \bfseries {$unitcode$} \tabularnewline[0.2cm]
      \bfseries TITLE OF PAPER: & \bfseries {$unittitle$} \tabularnewline[0.2cm]
      \bfseries TYPE: & \bfseries {$type$} \tabularnewline[0.2cm]
      \bfseries EXAM DURATION: & \bfseries {$duration$} \tabularnewline[0.2cm]
    \end{tabular}
    \fontsize{10}{11}\sf\raggedright
    \vspace{1cm}\par
    \textbf{AUTHORISED MATERIALS}\\[0.2cm]
    This is a open book exam. with the following permitted items.
    \begin{itemize}
    \item Blank pages for use as working sheets (provided).
    \item Python documentation, accessible through the link on the desktop.
    \item Lecture notes, either printed yourself, or the digital copies in the S: drive.
    \end{itemize}
    \vspace{1cm}\par
    %\textbf{RULES}\\[0.2cm]
  \end{textblock}
}

%% QUESTIONS
\usepackage{xifthen,titlesec}
\setcounter{secnumdepth}{1} % Only number questions
\newcounter{question}
\setcounter{question}{0}
\newcounter{mks}
\setcounter{mks}{0}
\def\marks#1{\par\rightline{\normalsize\fbox{\sffamily\emph{#1 marks}}}\addtocounter{mks}{#1}}
%\def\endquestion{\nopagebreak\vspace*{0.3cm}\par\nopagebreak\rightline{\normalsize\fbox{\sffamily\textbf{Total: \arabic{mks} marks}}}\vspace*{0.5cm}\pagebreak}
\def\endquestion{\nopagebreak\vspace*{0.3cm}\par\nopagebreak\rightline{\normalsize\fbox{\sffamily\textbf{Total: \arabic{mks} marks}}}\vspace*{0.5cm}}

\makeatletter
\titleformat{\section}[block]%
  {\fontsize{15}{15}\bfseries}%
  {\ifthenelse{\value{question} > 0}{\endquestion\clearpage}{}%
  {\sffamily\bfseries\Large\textbf{SECTION}~\addtocounter{question}{1}\Alph{question}}}
  {0.0em}{\noindent\setcounter{mks}{0}\@gobble}
\makeatother
\titleformat{\subsection}[block]
  {\fontsize{11}{12}\bfseries}{}{0.2em}{}

%% PDF title
\hypersetup{
  pdftitle={$unitcode$ - $unittitle$: Exam $semester$}
}
