% Fonts
\usepackage{bera}
\usepackage[charter]{mathdesign}
\usepackage[lf,t]{FiraSans}
%\usepackage[scale=0.9]{sourcecodepro}

\usepackage{lastpage,fancyhdr,verbatimbox,bm}
\usepackage[bottom]{footmisc}

\usepackage[absolute,overlay]{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}

%% Line and page breaking
\sloppy
\raggedbottom
\allowdisplaybreaks
\setlength{\parskip}{1.2ex}
\setlength{\parindent}{0em}
\clubpenalty = 10000
\widowpenalty = 10000

%% CAPTIONS
\DeclareCaptionStyle{italic}[justification=centering]
 {labelfont={bf},textfont={it},labelsep=colon}
\captionsetup[figure]{style=italic,format=hang,singlelinecheck=true}
\captionsetup[table]{style=italic,format=hang,singlelinecheck=true}

%% Floats
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.8}

%% Headers and footers
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\lhead{}
\rhead{}
\cfoot{}
\rfoot{\sf\textsl{Page \thepage\ of \pageref{LastPage}}}

% Redefine plain style so first page matches the rest.
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
  \fancyfoot[R]{\sf\textsl{Page \thepage\ of \pageref{LastPage}}}
}

% TITLE PAGE
\usepackage{titling}
\title{}
\author{}
\preauthor{}
\postauthor{}
\predate{}
\postdate{}
\date{}
\posttitle{\newpage}
\pretitle{\fontsize{12}{14}\sf
  \begin{textblock}{13}(2,0.7)
    \includegraphics[height=1.2cm]{tudlogo_descriptor}
  \end{textblock}
 \begin{textblock}{17}(2,3)\sffamily
    \begin{center}\bfseries\Large
      $faculty$\\
      $department$\\[0.8cm]
    \end{center}\vspace*{0.4cm}
    \begin{tabular}{@{}p{4.5cm}p{10cm}}
      \bfseries UNIT CODES:  & \bfseries {$unitcode$} \tabularnewline[0.2cm]
      \bfseries TITLE OF PAPER: & \bfseries {$unittitle$} \tabularnewline[0.2cm]
      \bfseries TYPE: & \bfseries {$type$} \tabularnewline[0.2cm]
      \bfseries EXAM DURATION: & \bfseries {$duration$} \tabularnewline[0.2cm]
    \end{tabular}
    \fontsize{10}{11}\sf\raggedright
    \\[0.8cm]
    $instructions$
  \end{textblock}
}

%% QUESTIONS
\usepackage{xifthen,titlesec}
\setcounter{secnumdepth}{1} % Only number questions

\newcounter{mks}
\setcounter{mks}{0}
\def\marks#1{\par\rightline{\normalsize\fbox{\sffamily\emph{#1 marks}}}\addtocounter{mks}{#1}}
\def\endquestion{\nopagebreak\vspace*{0.3cm}\par\nopagebreak\rightline{\normalsize\fbox{\sffamily\textbf{Total: \arabic{mks} marks}}}\vspace*{0.5cm}}

\makeatletter
\titleformat{\section}[block]%
  {\fontsize{15}{15}\sffamily\bfseries}% visual format for the heading text
  {}% no custom label (so the real title text is used)
  {0em}% separation between label and title (no label, so 0)
  {%
    % Close the previous section (except before the first) by printing its total
    \ifnum\value{section}>1\relax\endquestion\fi
    % Reset marks at the start of the new section
    \setcounter{mks}{0}%
  }%
%  [\vspace{0.3em}]  % optional after-code spacing
\makeatother

%% PDF title
\hypersetup{
  pdftitle={$unitcode$ - $unittitle$: Exam $semester$}
}
